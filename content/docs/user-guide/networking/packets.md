---
title: Network packet structure
linktitle: Packets
weight: 300
description: An overview and reference for the structure of UDP and TCP packets used by the Open 3D Engine networking stack.
toc: true
---

{{< preview-new >}}

Open 3D Engine has support for both TCP and UDP protocols in its networking stack, giving you the flexibility to choose how to connect your game to existing services and what level of overhead you want to introduce on server communications. While TCP packets contain minimal information themselves, there is the overhead (and assurance) of the TCP protocol behind these connections. UDP packets contain longer headers to help address consistency, even when packets may be dropped. This enables custom recovery mechanisms through O3DE Gems that allow for features like rollback.

This section only describes the overall packet structure, and doesn't cover best practices or information on efficient implementation of packet payload data.

{{< important >}}
When developing code which touches packet information, you **must** respect the requirements of the O3DE packet layout. Failing to do so might cause problems with the `Az::Networking` core. Take care that you preserve header information exactly as described in this section when implementing features like network compression or rollback.
{{< /important >}}

## Packet Types in O3DE

O3DE offers the following types of core packets, identified by their packet type information in the header:

* `InitiateConnectionPacket` - The first packet sent/received by a [connection](./connection), used to establish the link and begin negotiation.
* `ConnectionHandshakePacket` - Performs the handshake between the client and server.
* `TerminateConnectionPacket` -  Packet sent by a client or server when requesting that the connection be terminated. Note that not every connection will be terminated in a `TerminateConnectionPacket` - connection state can be affected by transport errors, latency, or other issues that may result in a dropped connection without receiving a `TerminateConnectionPacket`.
* `HeartbeatPacket` - A minimal packet used to ping the other side of the connection and keep it established.
* `FragmentedPacket` - A packet which exceeds the connection MTU and must be split into a sequence of packets to be reconstructed by the server.

All of these basic types of packets are generated by the [AzAutoGen](../engine/codegen/) system during build. The templates and data used to construct the fundamental O3DE packets are located in `Code/Framework/AzNetworking/AzNetworking/AutoGen`.

## TCP Packet Structure

TCP packets used by O3DE and `Az::Networking` infrastructure have the following data structure and requirements:

```
TCP Packet header: {
    Packet flags (uncompressed): 1 byte
    Packet type: 2 bytes
    Packet size: 2 bytes
}
```

## UDP Packet Structure

```
UDP Packet header: {
    Packet flags (uncompressed): 1 byte
    Packet type: 2 bytes
    Local sequence ID: 2 bytes
    Remote sequence ID: 2 bytes
    ACK replication: 4 bytes
    Reliability flag: 1 byte
    Reliable sequence ID: 2 bytes
}