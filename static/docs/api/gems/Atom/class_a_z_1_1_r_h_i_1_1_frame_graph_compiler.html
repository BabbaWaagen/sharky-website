<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/xhtml;charset=utf-8" http-equiv="Content-Type"/>
<meta content="IE=9" http-equiv="X-UA-Compatible"/>
<meta content="Doxygen 1.8.17" name="generator"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Atom API Reference: AZ::RHI::FrameGraphCompiler Class Reference</title>
<link href="/css/api-ref/tabs.css" rel="stylesheet" type="text/css"/>
<script src="jquery.js" type="text/javascript"></script>
<script src="dynsections.js" type="text/javascript"></script>
<link href="/css/api-ref/doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellpadding="0" cellspacing="0">
<tbody>
<tr style="height: 56px;">
<td id="projectalign" style="padding-left: 0.5em;">
<div id="projectname">Atom API Reference
   </div>
</td>
</tr>
</tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script src="menudata.js" type="text/javascript"></script>
<script src="menu.js" type="text/javascript"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div class="navpath" id="nav-path">
<ul>
<li class="navelem"><a class="el" href="namespace_a_z.html">AZ</a></li><li class="navelem"><b>RHI</b></li><li class="navelem"><a class="el" href="class_a_z_1_1_r_h_i_1_1_frame_graph_compiler.html">FrameGraphCompiler</a></li> </ul>
</div>
</div><!-- top -->
<div class="header">
<div class="summary">
<a href="#pub-methods">Public Member Functions</a> |
<a href="class_a_z_1_1_r_h_i_1_1_frame_graph_compiler-members.html">List of all members</a> </div>
<div class="headertitle">
<div class="title">AZ::RHI::FrameGraphCompiler Class Reference</div> </div>
</div><!--header-->
<div class="contents">
<p><code>#include &lt;FrameGraphCompiler.h&gt;</code></p>
<p>Inherits <a class="el" href="class_a_z_1_1_r_h_i_1_1_device_object.html">AZ::RHI::DeviceObject</a>.</p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a3a9bc81b2a66d9d839477d2faa5a90d8"><td align="right" class="memItemLeft" valign="top"><a id="a3a9bc81b2a66d9d839477d2faa5a90d8"></a>
 </td><td class="memItemRight" valign="bottom"><b>AZ_RTTI</b> (<a class="el" href="class_a_z_1_1_r_h_i_1_1_frame_graph_compiler.html">FrameGraphCompiler</a>, "{A126F362-C163-432E-94DE-61AA4DFDF102}", Object)</td></tr>
<tr class="separator:a3a9bc81b2a66d9d839477d2faa5a90d8"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:a4be4f9d99e7c9931f82fe714ff8e2b5c"><td align="right" class="memItemLeft" valign="top"><a id="a4be4f9d99e7c9931f82fe714ff8e2b5c"></a>
ResultCode </td><td class="memItemRight" valign="bottom"><b>Init</b> (<a class="el" href="class_a_z_1_1_r_h_i_1_1_device.html">Device</a> &amp;device)</td></tr>
<tr class="separator:a4be4f9d99e7c9931f82fe714ff8e2b5c"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:a6132cf9d410b96bece15ba5d648aba1b"><td align="right" class="memItemLeft" valign="top"><a id="a6132cf9d410b96bece15ba5d648aba1b"></a>
void </td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_z_1_1_r_h_i_1_1_frame_graph_compiler.html#a6132cf9d410b96bece15ba5d648aba1b">Shutdown</a> () override final</td></tr>
<tr class="memdesc:a6132cf9d410b96bece15ba5d648aba1b"><td class="mdescLeft"> </td><td class="mdescRight">Clears the current bound device to null. <br/></td></tr>
<tr class="separator:a6132cf9d410b96bece15ba5d648aba1b"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:a08ddc09a7843f299d4739c1a7c45c617"><td align="right" class="memItemLeft" valign="top">MessageOutcome </td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_z_1_1_r_h_i_1_1_frame_graph_compiler.html#a08ddc09a7843f299d4739c1a7c45c617">Compile</a> (const <a class="el" href="struct_a_z_1_1_r_h_i_1_1_frame_graph_compile_request.html">FrameGraphCompileRequest</a> &amp;request)</td></tr>
<tr class="separator:a08ddc09a7843f299d4739c1a7c45c617"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="inherit_header pub_methods_class_a_z_1_1_r_h_i_1_1_device_object"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_class_a_z_1_1_r_h_i_1_1_device_object')"><img alt="-" src="/images/api-ref/closed.png"/> Public Member Functions inherited from <a class="el" href="class_a_z_1_1_r_h_i_1_1_device_object.html">AZ::RHI::DeviceObject</a></td></tr>
<tr class="memitem:af8ebb6e0733cffe3f3d2b61f8c9b47df inherit pub_methods_class_a_z_1_1_r_h_i_1_1_device_object"><td align="right" class="memItemLeft" valign="top"><a id="af8ebb6e0733cffe3f3d2b61f8c9b47df"></a>
 </td><td class="memItemRight" valign="bottom"><b>AZ_RTTI</b> (<a class="el" href="class_a_z_1_1_r_h_i_1_1_device_object.html">DeviceObject</a>, "{17D34F71-944C-4AF5-9823-627474C4C0A6}", Object)</td></tr>
<tr class="separator:af8ebb6e0733cffe3f3d2b61f8c9b47df inherit pub_methods_class_a_z_1_1_r_h_i_1_1_device_object"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:a084b1f4b7301a8ac485d8d90c3d76f79 inherit pub_methods_class_a_z_1_1_r_h_i_1_1_device_object"><td align="right" class="memItemLeft" valign="top"><a id="a084b1f4b7301a8ac485d8d90c3d76f79"></a>
bool </td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_z_1_1_r_h_i_1_1_device_object.html#a084b1f4b7301a8ac485d8d90c3d76f79">IsInitialized</a> () const</td></tr>
<tr class="memdesc:a084b1f4b7301a8ac485d8d90c3d76f79 inherit pub_methods_class_a_z_1_1_r_h_i_1_1_device_object"><td class="mdescLeft"> </td><td class="mdescRight">Returns whether the device object is initialized. <br/></td></tr>
<tr class="separator:a084b1f4b7301a8ac485d8d90c3d76f79 inherit pub_methods_class_a_z_1_1_r_h_i_1_1_device_object"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:a60ef85d32f44322001e14bde7493dc21 inherit pub_methods_class_a_z_1_1_r_h_i_1_1_device_object"><td align="right" class="memItemLeft" valign="top"><a class="el" href="class_a_z_1_1_r_h_i_1_1_device.html">Device</a> &amp; </td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_z_1_1_r_h_i_1_1_device_object.html#a60ef85d32f44322001e14bde7493dc21">GetDevice</a> () const</td></tr>
<tr class="separator:a60ef85d32f44322001e14bde7493dc21 inherit pub_methods_class_a_z_1_1_r_h_i_1_1_device_object"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="inherit_header pub_methods_class_a_z_1_1_r_h_i_1_1_object"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_class_a_z_1_1_r_h_i_1_1_object')"><img alt="-" src="/images/api-ref/closed.png"/> Public Member Functions inherited from <a class="el" href="class_a_z_1_1_r_h_i_1_1_object.html">AZ::RHI::Object</a></td></tr>
<tr class="memitem:a012597da80a60928f8f647bed014be73 inherit pub_methods_class_a_z_1_1_r_h_i_1_1_object"><td align="right" class="memItemLeft" valign="top"><a id="a012597da80a60928f8f647bed014be73"></a>
 </td><td class="memItemRight" valign="bottom"><b>AZ_RTTI</b> (<a class="el" href="class_a_z_1_1_r_h_i_1_1_object.html">Object</a>, "{E43378F1-2331-4173-94B8-990ED20E6003}")</td></tr>
<tr class="separator:a012597da80a60928f8f647bed014be73 inherit pub_methods_class_a_z_1_1_r_h_i_1_1_object"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:a9486615a64c9e9f0ce2c6eb0bbab2d35 inherit pub_methods_class_a_z_1_1_r_h_i_1_1_object"><td align="right" class="memItemLeft" valign="top">void </td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_z_1_1_r_h_i_1_1_object.html#a9486615a64c9e9f0ce2c6eb0bbab2d35">SetName</a> (const Name &amp;name)</td></tr>
<tr class="separator:a9486615a64c9e9f0ce2c6eb0bbab2d35 inherit pub_methods_class_a_z_1_1_r_h_i_1_1_object"><td class="memSeparator" colspan="2"> </td></tr>
<tr class="memitem:a3974b3af221310b51746ee2b193b57e8 inherit pub_methods_class_a_z_1_1_r_h_i_1_1_object"><td align="right" class="memItemLeft" valign="top">const Name &amp; </td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_z_1_1_r_h_i_1_1_object.html#a3974b3af221310b51746ee2b193b57e8">GetName</a> () const</td></tr>
<tr class="separator:a3974b3af221310b51746ee2b193b57e8 inherit pub_methods_class_a_z_1_1_r_h_i_1_1_object"><td class="memSeparator" colspan="2"> </td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="inherited"></a>
Additional Inherited Members</h2></td></tr>
<tr class="inherit_header pro_methods_class_a_z_1_1_r_h_i_1_1_device_object"><td colspan="2" onclick="javascript:toggleInherit('pro_methods_class_a_z_1_1_r_h_i_1_1_device_object')"><img alt="-" src="/images/api-ref/closed.png"/> Protected Member Functions inherited from <a class="el" href="class_a_z_1_1_r_h_i_1_1_device_object.html">AZ::RHI::DeviceObject</a></td></tr>
<tr class="memitem:a80ab91a69f8f962f519c29f6529cac51 inherit pro_methods_class_a_z_1_1_r_h_i_1_1_device_object"><td align="right" class="memItemLeft" valign="top"><a id="a80ab91a69f8f962f519c29f6529cac51"></a>
void </td><td class="memItemRight" valign="bottom"><a class="el" href="class_a_z_1_1_r_h_i_1_1_device_object.html#a80ab91a69f8f962f519c29f6529cac51">Init</a> (<a class="el" href="class_a_z_1_1_r_h_i_1_1_device.html">Device</a> &amp;device)</td></tr>
<tr class="memdesc:a80ab91a69f8f962f519c29f6529cac51 inherit pro_methods_class_a_z_1_1_r_h_i_1_1_device_object"><td class="mdescLeft"> </td><td class="mdescRight">The derived class should call this method to assign the device. <br/></td></tr>
<tr class="separator:a80ab91a69f8f962f519c29f6529cac51 inherit pro_methods_class_a_z_1_1_r_h_i_1_1_device_object"><td class="memSeparator" colspan="2"> </td></tr>
</table>
<a id="details" name="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><a class="el" href="class_a_z_1_1_r_h_i_1_1_frame_graph_compiler.html">FrameGraphCompiler</a> controls compilation of <a class="el" href="class_a_z_1_1_r_h_i_1_1_frame_graph.html">FrameGraph</a> each frame. <a class="el" href="class_a_z_1_1_r_h_i_1_1_frame_scheduler.html">FrameScheduler</a> owns and drives an instance of this class, so end-users should never need to interact with it directly. Platform implementations, on the other hand, are required to override this class in order to perform platform-specific scope construction.</p>
<p>The compiler is designed to be invoked every frame; the graph is simply rebuilt each time. The compile operation is also done on a single thread; so overhead should be kept to a minimum.</p>
<p>The RHI base class performs platform-independent compilation before passing control down to the derived platform implementation. The provided <a class="el" href="class_a_z_1_1_r_h_i_1_1_frame_graph.html">FrameGraph</a> instance is compiled in-place according to the following phases: </p><pre class="fragment"> == Cross-Queue Graph Edges == 
</pre><p><a class="el" href="class_a_z_1_1_r_h_i_1_1_frame_graph.html">FrameGraph</a> contains a graph of <a class="el" href="class_a_z_1_1_r_h_i_1_1_scope.html">Scope</a> instances. Scopes are topologically sorted prior to compilation as part of the graph construction process. Scopes associate directly to a "Hardware Queue Class": Graphics, Compute, or Copy. These three queue classes must be synchronized between each other. To make this easier on platforms, the base compiler takes the topologically flattened graph and collates it into three independent sorted lists–one for each queue class. Then, a queue-centric producer-consumer graph is constructed across the scopes. Specifically:</p>
<p>class <a class="el" href="class_a_z_1_1_r_h_i_1_1_scope.html">Scope</a> { Scope* m_producersByQueue[HardwareQueueClassCount]; Scope* m_consumersByQueue[HardwareQueueClassCount]; };</p>
<p>This graph makes it possible to walk along a queue or across queue boundaries at dependency points. Each platform can then trivially crawl this graph to derive signal / wait fence values, if applicable. </p><pre class="fragment"> == Transient Attachments ==
</pre><p>Transient attachments are intra-frame and do not persist after the frame ends and can take the form of buffers or images. These attachments are owned by a <a class="el" href="class_a_z_1_1_r_h_i_1_1_transient_attachment_pool.html">TransientAttachmentPool</a>; every frame, the pool is reset. Since attachments are always declared for usage on scopes, its full usage chain–and thus its lifetime across the frame–is immediately available.</p>
<p>The phase first constructs the scope lifetime for each attachment. Then, memory for each attachment is allocated from the transient attachment pool, one scope at a time. This allows the pool to record begin and end usages for each attachment per scope. Internally, the platform implementation can use this information to place aliased resources onto one or more heaps of memory.</p>
<p>One important consideration is dealing with aliasing across queue boundaries. Since queues must be synchronized between each other, attempting to alias memory across two queues at the same time will produce a race condition. To solve this, when faced with a queue overlap, the compiler extends the lifetime of the attachment until a join operation occurs. However, the compiler picks a single queue which is allowed to alias during that region by inspecting which one will see the biggest potential gain. This way, some aliasing is still allowed when async compute / copy is in use.</p>
<p>Finally, because the resources themselves are effectively re-created each frame, a cache of views is kept inside the compiler. The cache is big enough to avoid having to re-create views every frame, but bounded in order to release entries old views. </p><pre class="fragment"> == Platform-Specific Compilation ==
</pre><p>Finally, the compiler calls into the platform-specific compile method, which hands control over to the derived class. The platform implementation is expected to further process the frame graph and scope data down to platform-specific actions. For example:</p>
<p>1) Derive transition barriers by walking the scope attachment chain on each frame attachment. 2) Derive queue fence values by walking the queue-centric scope graph. </p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="a08ddc09a7843f299d4739c1a7c45c617"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a08ddc09a7843f299d4739c1a7c45c617">◆ </a></span>Compile()</h2>
<div class="memitem">
<div class="memproto">
<table class="memname">
<tr>
<td class="memname">MessageOutcome AZ::RHI::FrameGraphCompiler::Compile </td>
<td>(</td>
<td class="paramtype">const <a class="el" href="struct_a_z_1_1_r_h_i_1_1_frame_graph_compile_request.html">FrameGraphCompileRequest</a> &amp; </td>
<td class="paramname"><em>request</em></td><td>)</td>
<td></td>
</tr>
</table>
</div><div class="memdoc">
<p>Compiles the frame graph. Platform-independent compilation is done first according to the provided flags. At the end, the platform-dependent compilation method is invoked. </p>
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue May 4 2021 15:16:53 for Atom API Reference by  <a href="http://www.doxygen.org/index.html">
<img alt="doxygen" class="footer" src="/images/api-ref/doxygen.png"/>
</a> 1.8.17
</small></address>
</body>
</html>
